<include file="Public/header" title="编辑广告" keywords="" />
<div class="page-container">
    <include file="Public/nav" />
    <div class="main-content">

    <!-- User Info, Notifications and Menu Bar -->
    <include file="Public/user_nav" />
    <div class="page-title">
        <div class="title-env">
            <h1 class="title">编辑广告</h1>
            <p class="description">后台管理编辑广告</p>
        </div>
        <div class="breadcrumb-env">
            <ol class="breadcrumb bc-1">
                <li> <a href="{:U('Index/index')}"><i class="fa-home"></i>主页</a> </li>
                <li> 站点设置 </li>
                <li class="active"> <strong>编辑广告 </strong></li>
            </ol>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="alert alert-success" style="display: none" id="success">
                <strong></strong>
            </div>
        </div>
        <div class="col-md-12">
            <div class="alert alert-danger" id="error" style="display:none">
                <strong></strong>
            </div>
        </div>
    </div>


    <div class="row">
        <div class="col-sm-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">编辑广告</h3>
                    <div class="panel-options">
                        <a href="#" data-toggle="panel">
                            <span class="collapse-icon">&ndash;</span>
                            <span class="expand-icon">+</span>
                        </a>
                        <a href="#" data-toggle="remove"> &times; </a>
                    </div>
                </div>

                <div class="panel-body">
                    <form role="form" method="post" class="form-horizontal" action="{:U('Advert/biyouEdit')}"   enctype="multipart/form-data">
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="type_id">广告分类</label>
                            <div class="col-sm-10">
                                <select name="type_id" id="type_id" class="form-control" style="width: 25%;">
                                    <option value="0">请选择广告分类</option>
                                    <foreach name="all_board" item="v" key="k">
                                        <option value="{$k}" <if condition="$list['type_id'] eq $k">selected</if>>{$v}</option>
                                    </foreach>
                                </select>
                            </div>
                        </div>
                        <div class="form-group-separator"></div>

                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="title">广告名称</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="title" value="{$list['title']}" name="title" placeholder="请输入广告名称">
                            </div>
                        </div>

                        <div class="form-group-separator"></div>

                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="url">跳转链接</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="url" value="{$list['url']}" name="url" placeholder="请输入跳转链接">
                            </div>
                        </div>

                        <div class="form-group-separator"></div>

                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="coupon_img_url">上传图片</label>
                            <div class="col-sm-6">
                                <input type="file" class="form-control" id="coupon_upload_img" name="img">
                                <input type="hidden" class="form-control" id="coupon_img_url" name="content" value="{$list.img}">
                            </div>
                            <div class="col-sm-2">
                                <button type="button" id='coupon_img_url_upd' onclick="ajaxFileUpload('coupon_upload_img','coupon_img_url','coupon_img')" class="form-control">上传图片</button>
                            </div>
                            <div class="col-sm-2">
                                <a id="coupon_img" href="{$list.img}" target="_blank"><img <notempty name="list.img">src="{:getImgUrl($list['img'])}"</notempty> style="width: 80px" /></a>
                            </div>
                        </div>

                        <div class="form-group-separator"></div>

                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="begin_time">开始时间</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control datepicker" id="begin_time" value="{$list['begin_time']|date='m/d/Y',###}" name="begin_time" placeholder="请输入开始时间">
                            </div>
                        </div>

                        <div class="form-group-separator"></div>

                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="end_time">结束时间</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control datepicker" id="end_time" value="{$list['end_time']|date='m/d/Y',###}" name="end_time" placeholder="请输入结束时间">
                            </div>
                        </div>

                        <div class="form-group-separator"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label" for="sort">排序</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="sort" value="{$list['sort']}" name="sort" placeholder="请输入排序">
                            </div>
                        </div>

                        <div class="form-group-separator"></div>
                        <div class="form-group">
                            <label class="col-sm-2 control-label">状态</label>
                            <div class="col-sm-10">
                                <input type="radio" value="1" name="status"
                                <if condition="$list['status'] eq 1"> checked="checked" </if>
                                >有效
                                <input type="radio" value="0" name="status"
                                <if condition="$list['status'] eq 0"> checked="checked" </if>
                                >无效
                            </div>
                        </div>
                        <input type="hidden" name="id" value="{$list['id']}">
                        <div class="form-group-separator"></div>
                        <div class="form-group">
                            <div class="col-sm-2 "></div>
                            <div class="col-sm-10">
                                <input type="submit" class="btn btn-secondary  btn-single" value="编辑广告">
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
<include file="Public/footer" /> </div>
<script src="__JS__/datepicker/bootstrap-datepicker.js"></script>
<script src="__JS__/ajaxfileupload.js"></script>
<script type="text/javascript">
    //异步上传图片
    function ajaxFileUpload(name, trueInput, img) {
        //判断是否有选择上传文件
        var imgPath = $('#' + name).val();
        if (!imgPath) {
            setInputClass('order_img_url', 1, "请选择上传图片！");
            return false;
        }
        $.ajaxFileUpload({
            url: "{:U('Common/uploadImg')}",
            secureuri: false, //是否需要安全协议，一般设置为false
            fileElementId: name, //文件上传域的ID
            dataType: 'json', //返回值类型 一般设置为json
            success: function (data) {
                if (data.error == 1) {
                    setInputClass('order_img_url', 1, '上传失败 : ' + data.message);
                    return false;
                } else {
                    $('#' + img).attr('href', data.url).find('img').attr('src', data.url);
                    $('#' + trueInput).val(data.db_url);
                    setInputClass('order_img_url', 0, '图片上传成功');
                }
            },
            error: function (e) {
                setInputClass('order_img_url', 1, '通讯失败');
            }
        });
    }
    //设置表单提醒与错误
    function setInputClass(idName, type, msg) {
        var items = $("#" + idName);
        var msgItems = items.parent().next('.msg');
        //alert(items);
        if (type == 1) {
            items.parent().parent('.form-group').attr('class', 'form-group has-error');
            msgItems.text(msg);
            $('#error').find('strong').text(msg);
            $('#error').show();
            setTimeout(function () {
                $('#error').hide();
            }, 3000)
        } else if (type == 2) {
            items.parent().parent('.form-group').attr('class', 'form-group has-warning');
            msgItems.text(msg);
        } else {
            items.parent().parent('.form-group').attr('class', 'form-group has-success');
            msgItems.text("");
            $('#success').find('strong').text(msg);
            $('#success').show();
            setTimeout(function () {
                $('#success').hide();
            }, 3000)
        }
    }
</script>
<include file="Public/footer_Js" />