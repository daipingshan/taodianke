<include file="Public/header" title="宅喵生活公众号管理" keywords="宅喵生活公众号管理"/>
<div class="page-container">
    <include file="Public/nav"/>
    <div class="main-content">
        <!-- User Info, Notifications and Menu Bar -->
        <include file="Public/user_nav"/>
        <div class="page-title">
            <div class="title-env">
                <h1 class="title">宅喵生活公众号管理</h1>
            </div>
            <div class="breadcrumb-env">
                <ol class="breadcrumb bc-1">
                    <li><a href="/AppAdmin/"><i class="fa-home"></i>主页</a></li>
                    <li class="active"> 宅喵生活管理</li>
                    <li class="active"><strong>宅喵生活公众号管理</strong></li>
                </ol>
            </div>
        </div>

        <div class="row">
            <div class="col-md-12">
                <div class="alert alert-success" style="display: none">
                    <button type="button" class="close" data-dismiss="alert">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <strong></strong>
                </div>
            </div>
            <div class="col-md-12">
                <div class="alert alert-danger" style="display: none;">
                    <button type="button" class="close" data-dismiss="alert">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <strong></strong>
                </div>
            </div>
            <div class="col-md-12">
                <ul class="nav nav-tabs nav-tabs-justified">
                    <li class="active">
                        <a href="#home-1" data-toggle="tab">
                            <span class="visible-xs"><i class="fa-home"></i></span>
                            <span class="hidden-xs">公众号管理</span>
                        </a>
                    </li>
                    <li>
                        <a href="#home-2" data-toggle="tab">
                            <span class="visible-xs"><i class="fa-home"></i></span>
                            <span class="hidden-xs">公众号基础配置</span>
                        </a>
                    </li>
                    <li>
                        <a href="#home-4" data-toggle="tab">
                            <span class="visible-xs"><i class="fa-home"></i></span>
                            <span class="hidden-xs">底部菜单设置</span>
                        </a>
                    </li>
                    <li>
                        <a href="#home-5" data-toggle="tab">
                            <span class="visible-xs"><i class="fa-home"></i></span>
                            <span class="hidden-xs">签到比例配置</span>
                        </a>
                    </li>
                    <li>
                        <a href="#home-6" data-toggle="tab">
                            <span class="visible-xs"><i class="fa-home"></i></span>
                            <span class="hidden-xs">开发中</span>
                        </a>
                    </li>

                </ul>

                <div class="tab-content">
                    <div class="tab-pane active" id="home-1">
                        <div>
                            <form class="save">
                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="first_subscribe">首次关注提示信息</label>
                                    <div class="col-sm-10">
                                        <div class="form-block">
                                            <textarea class="form-control check" id="first_subscribe"
                                                      placeholder="请输入首次关注提示信息！"
                                                      name="STORE_WEIXIN_MP[first_subscribe_msg]"
                                                      rows="10">{$content['STORE_WEIXIN_MP']['first_subscribe_msg']}</textarea>
                                        </div>
                                    </div>
                                    <div style="clear: both"></div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="repeat_msg">重复扫描关注提示信息</label>
                                    <div class="col-sm-10">
                                        <div class="form-block">
                                            <textarea class="form-control check" id="repeat_msg"
                                                      placeholder="请输入重复扫描关注提示信息！"
                                                      name="STORE_WEIXIN_MP[repeat_subscribe_msg]" rows="10">{$content['STORE_WEIXIN_MP']['repeat_subscribe_msg']}</textarea>
                                        </div>
                                    </div>
                                    <div style="clear: both"></div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="weixin_title">图文会话标题</label>
                                    <div class="col-sm-10">
                                        <div class="form-block">
                                            <label>
                                                <input type="text" class="form-control check" id="weixin_title"
                                                       name="STORE_WEIXIN_MP[title]"
                                                       value="{$content['STORE_WEIXIN_MP']['title']}"
                                                       placeholder="请输入图文会话标题！">
                                            </label>
                                        </div>
                                    </div>
                                    <div style="clear: both"></div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="bg_image">图文会话背景图</label>
                                    <div class="col-sm-10">
                                        <div class="form-block">
                                            <label>
                                                <input type="text" class="form-control check" id="bg_image"
                                                       name="STORE_WEIXIN_MP[bg_image]"
                                                       value="{$content['STORE_WEIXIN_MP']['bg_image']}"
                                                       placeholder="请输入图文会话背景图！">
                                            </label>
                                        </div>
                                    </div>
                                    <div style="clear: both"></div>
                                </div>

                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="bg_url">图文会话链接</label>
                                    <div class="col-sm-10">
                                        <div class="form-block">
                                            <label>
                                                <input type="text" class="form-control check" id="bg_url"
                                                       name="STORE_WEIXIN_MP[bg_url]"
                                                       value="{$content['STORE_WEIXIN_MP']['bg_url']}"
                                                       placeholder="请输入图文会话链接！">
                                            </label>
                                        </div>
                                    </div>
                                    <div style="clear: both"></div>
                                </div>


                                <div class="form-group">
                                    <label class="col-sm-2 control-label" for="share_bg_url">分享二维码的背景图</label>
                                    <div class="col-sm-6">
                                        <input type="file" class="form-control" id="coupon_upload_img" name="img">
                                        <input type="hidden" id="share_bg_url" class="form-control"
                                               name="STORE_WEIXIN_MP[share_bg_url]">
                                    </div>
                                    <div class="col-sm-2">
                                        <button type="button" id='coupon_img_url_upd'
                                                onclick="ajaxFileUpload('coupon_upload_img','share_bg_url','coupon_img')"
                                                class="form-control">上传图片
                                        </button>
                                    </div>
                                    <div class="col-sm-2">
                                        <a id="coupon_img" href="/Uploads/wxqrcode_bg.jpg" target="_blank"><img
                                                src="/Uploads/wxqrcode_bg.jpg" width="100" height="150"/></a>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <div class="col-sm-2 "></div>
                                    <div class="col-sm-10">
                                        <input type="submit" id="public_info" class="btn btn-secondary  btn-single"
                                               value="保存">
                                    </div>
                                    <div style="clear: both"></div>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="tab-pane" id="home-2">
                        <form class="save">
                            <div class="form-group">
                                <label class="col-sm-2 control-label" for="app_id">微信开发app_id</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control check" id="app_id"
                                           name="STORE_WEIXIN_BASE[app_id]"
                                           value="{$content['STORE_WEIXIN_BASE']['app_id']}"
                                           placeholder="请输入微信开发app_id！">
                                </div>
                                <div style="clear: both"></div>
                            </div>

                            <div class="form-group">
                                <label class="col-sm-2 control-label" for="app_secret">微信开发app_secret</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control check" id="app_secret"
                                           name="STORE_WEIXIN_BASE[app_secret]"
                                           value="{$content['STORE_WEIXIN_BASE']['app_secret']}"
                                           placeholder="请输入微信开发app_secret！">
                                </div>
                                <div style="clear: both"></div>
                            </div>

                            <div class="form-group">
                                <label class="col-sm-2 control-label" for="app_secret">公众号域名</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control check"
                                           name="STORE_WEIXIN_BASE[public_number_url]"
                                           value="{$content['STORE_WEIXIN_BASE']['public_number_url']}"
                                           placeholder="请输入微信公众号域名！">
                                </div>
                                <div style="clear: both"></div>
                            </div>

                            <div class="form-group">
                                <label class="col-sm-2 control-label" for="check_coupon_tmpl_id">验券成功消息模板ID</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control check" id="check_coupon_tmpl_id"
                                           name="STORE_WEIXIN_BASE[check_coupon_tmpl_id]"
                                           value="{$content['STORE_WEIXIN_BASE']['check_coupon_tmpl_id']}"
                                           placeholder="请输入验券成功消息模板ID！">
                                </div>
                                <div style="clear: both"></div>
                            </div>

                            <div class="form-group">
                                <label class="col-sm-2 control-label" for="deal_end_tmpl_id">商品到期提醒消息模板ID</label>
                                <div class="col-sm-6">
                                    <input type="text" class="form-control check" id="deal_end_tmpl_id"
                                           name="STORE_WEIXIN_BASE[deal_end_tmpl_id]"
                                           value="{$content['STORE_WEIXIN_BASE']['deal_end_tmpl_id']}"
                                           placeholder="请输入商品到期提醒消息模板ID！">
                                </div>
                                <div style="clear: both"></div>
                            </div>

                            <div class="form-group">
                                <div class="col-sm-2 "></div>
                                <div class="col-sm-2">
                                    <input type="submit" id="wechat_base" class="btn btn-secondary  btn-single"
                                           value="保存">
                                </div>
                                <div style="clear: both"></div>
                            </div>
                        </form>
                    </div>
                    <div class="tab-pane" id="home-4">
                        <form class="save">

                            <div class="form-group">
                                <label class="col-sm-2 control-label">底部菜单</label>
                                <div class="col-sm-10">
                                    <textarea class="form-control check" placeholder="请输入正确的菜单内容！"
                                              name="STORE_WEIXIN_BASE[footer_menu]"
                                              rows="15">{$content['STORE_WEIXIN_BASE']['footer_menu']}</textarea>
                                </div>
                                <div style="clear: both"></div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-2 "></div>
                                <div class="col-sm-10">
                                    <input type="submit" class="btn btn-secondary  btn-single" id="submit_menu"
                                           value="提交">
                                </div>
                                <div style="clear: both"></div>
                            </div>
                        </form>
                    </div>
                    <div class="tab-pane" id="home-5">
                        <form class="save">
                            <div class="form-group">
                                <label class="col-sm-2 control-label">签到使用比例</label>
                                <div class="col-sm-4">
                                    <input type="number" class="form-control check"
                                           placeholder="请输入签到使用比例（0-100 即10%->10）！"
                                           name="WEIXIN_DAYSIGN[rate]" value="{$content['WEIXIN_DAYSIGN']['rate']}"/>
                                </div>
                                <div class="col-sm-6">
                                    <span style="color: red;line-height: 32px">（0-100 即10%->10）</span>
                                </div>
                                <div style="clear: both"></div>
                            </div>
                            <div class="form-group">
                                <div class="col-sm-2 "></div>
                                <div class="col-sm-10">
                                    <input type="submit" class="btn btn-secondary  btn-single" id="day-sign"
                                           value="提交">
                                </div>
                                <div style="clear: both"></div>
                            </div>
                        </form>
                    </div>
                    <div class="tab-pane" id="home-6">
                        正在开发中.....
                    </div>
                </div>
            </div>
        </div>
        <include file="Public/footer"/>
    </div>
    <include file="Public/footer_Js"/>
    <script src="__JS__/ajaxfileupload.js"></script>
    <script>

        $(function () {
            $('input[type=submit]').click(function () {
                var status = true;
                var id = $(this).attr('id');
                var post_url = '';
                if (id == 'submit_menu') {
                    post_url = "{:U('setFooterMenu')}";
                } else {
                    post_url = "{:U('editConfig')}";
                }
                var val = '';
                var _this = $(this);
                $(this).parents('form.save').find('.check').each(function () {
                    val = $(this).val();
                    val = trim(val);
                    if (!val) {
                        $('.alert-danger strong').text($(this).attr('placeholder'));
                        $('.alert-danger').show();
                        setTimeout(function () {
                            $('.alert-danger').hide();
                        }, 3000)
                        status = false;
                        return false;
                    }
                });
                if (status) {
                    $.post(post_url, _this.parents('form').serialize(), function (res) {
                        if (res.status == 1) {
                            $('.alert-success strong').text(res.info);
                            $('.alert-success').show();
                            setTimeout(function () {
                                $('.alert-success').hide();
                            }, 3000)
                        } else {
                            $('.alert-danger strong').text(res.info);
                            $('.alert-danger').show();
                            setTimeout(function () {
                                $('.alert-danger').hide();
                            }, 3000)
                        }
                    })
                }
                return false;
            });
        })

        //异步上传图片
        function ajaxFileUpload(name, trueInput, img, now) {
            //判断是否有选择上传文件
            var imgPath = $('#' + name).val();
            if (!imgPath) {
                setInputClass('order_img_url', 1, "请选择上传图片！");
                return false;
            }
            $.ajaxFileUpload({
                url: "{:U('Common/uploadImgLocal')}",
                secureuri: false, //是否需要安全协议，一般设置为false
                fileElementId: name, //文件上传域的ID
                dataType: 'json', //返回值类型 一般设置为json
                success: function (data) {
                    if (data.code == 1) {
                        InfoMsg(data.code, data.msg);
                        return false;
                    } else {
                        $('#' + img).attr({
                            'href': data.url,
                            'class': 'upIMG' + name
                        }).find('img').attr({'src': data.url, 'class': 'col-sm-12 upIMG' + name});
                        $('#' + trueInput).val(data.url);
                        InfoMsg(data.code, data.msg);
                    }
                },
                error: function (e) {
                    setInputClass('order_img_url', 1, '通讯失败');
                }
            });
        }

        //设置表单提醒与错误
        function InfoMsg(code, msg) {
            if (code == 1) {
                $('#fail').find('strong').text(msg);
                $('#fail').show();
                setTimeout(function () {
                    $('#fail').hide();
                }, 3000)
            } else {
                $('#success').find('strong').text(msg);
                $('#success').show();
                setTimeout(function () {
                    $('#success').hide();
                }, 3000)
            }

        }

        function trim(str) {
            var result;
            result = str.replace(/(^\s+)|(\s+$)/g, "");
            result = result.replace(/\s/g, "");
            return result;
        }
    </script>
</div>
</html>